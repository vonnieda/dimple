import { ScrollView, VerticalBox } from "std-widgets.slint";
import { CardAdapter } from "../components/card.slint";
import { CardGrid, CardGridAdapter } from "../components/card_grid.slint";
import { Styles, Texxt, PageTitle, SectionTitle, SectionSubtitle, AppState, Navigator } from "../common.slint";
import { LinkAdapter } from "../components/link.slint";
import { PopupMenu, PopupMenuButton } from "../components/popup_menu.slint";

export struct HomeSectionAdapter {
    title: string,
    sub-title: string,
    cards: [CardAdapter],    
}

export global HomeAdapter {
    in-out property <[HomeSectionAdapter]> sections: [
        { title: "For You", sub-title: "From your listens.", cards: [
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"},
            sub-title: {name: "A Thing With Super Ultra Mega Stuff"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"},
            sub-title: {name: "A Thing With Super Ultra Mega Stuff"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"},
            sub-title: {name: "A Thing With Super Ultra Mega Stuff"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"},
            sub-title: {name: "A Thing With Super Ultra Mega Stuff"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
        ]},
        { title: "Recents", cards: [
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
        ]},
        { title: "New Releases", cards: [
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
        ]},
        { title: "Popular", sub-title: "With other MusicBrainz listeners.", cards: [
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
        ]},
        { title: "Old Favorites", cards: [
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
            { image: {image: @image-url("../../icons/phosphor/PNGs/regular/vinyl-record.png")},
            title: {name: "A Reign of Fish"}},
        ]},
    ];
}

component CardMenu inherits PopupMenu {
    in property <CardAdapter> model;

    PopupMenuButton {
        text: "Play Later";
        icon: @image-url("../../icons/phosphor/SVGs/regular/list-plus.svg");
        clicked => { AppState.play_later(model.key); }
    }
    PopupMenuButton {
        text: "Play Next";
        icon: @image-url("../../icons/phosphor/SVGs/regular/queue.svg");
        clicked => { AppState.play_next(model.key); }
    }
    PopupMenuButton {
        text: "Play Now";
        icon: @image-url("../../icons/phosphor/SVGs/regular/play.svg");
        clicked => { AppState.play_now(model.key); }
    }
    PopupMenuButton {
        text: "Details";
        icon: @image-url("../../icons/phosphor/SVGs/regular/info.svg");
        clicked => { Navigator.navigate(model.title.url); }
    }
}    

export component Home inherits ScrollView {
    horizontal-scrollbar-policy: always-off;

    in-out property <length> card-menu-x;
    in-out property <length> card-menu-y;
    in-out property <CardAdapter> card-menu-model;
    card-menu := CardMenu {
        x: card-menu-x;
        y: card-menu-y;
        model: card-menu-model;
        width: self.preferred-width;
        height: self.preferred-height;
    }

    VerticalBox {
        width: 100%;
        alignment: start;
        padding: 0;

        PageTitle {
            text: "Home";
        }

        for section in HomeAdapter.sections: VerticalBox {
            alignment: start;
            padding: 0;
            padding-bottom: 16px;
            VerticalLayout {
                SectionTitle {
                    text: section.title;
                }
                if section.sub-title != "": SectionSubtitle {
                    text: section.sub-title;
                }
            }
            CardGrid {
                cards: section.cards;
                max-rows: 1;
                pointer-event(event, x, y, model) => {
                    if event.kind == PointerEventKind.up && event.button == PointerEventButton.right {
                        root.card-menu-x = x;
                        root.card-menu-y = y;
                        root.card-menu-model = model;
                        card-menu.show();
                    }
                }
            }
        }
    }
}